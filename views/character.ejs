<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .modal-body {
            background-color:#1D1F39 !important;
        color:#ffffff !important;
        border: 2px solid black;
        }
        .card{
        background-color:#06283D !important;
        color:#ffffff !important;
        border: 2px solid black;
      }
      .tab-pane{
        padding: auto;
        background-color:#06283D !important;
        color:#ffffff !important;
      }
        .my-link-style:hover{
            text-decoration: underline;
            background-color: white;
            color: black;
        }
        .nav-pills .nav-link.active, .nav-pills .show>.nav-link {
            color: black;
            background-color:white;
        }
        .my-link-style2{
            color: white;
            font-family: Arial, Helvetica, sans-serif;
        }
        .img-eye{
          width:70%;
          height:70%;
        }
        .fontstyle{
            text-decoration: none;
            font-size: 20px;
            color:#FFF89C;
        }
        .bgcolor{
            background-color: #411530;
        }
        .rank{
            color: black
        }
        .container{
            border: 5px solid black;
        }
        .box{
            background-color:#06283D !important;
        color:#ffffff !important;
        border: 2px solid black;
        }
    pre {
  white-space: pre-wrap;
  font-size: 20px;
  font-family: "Helvetica Neue",Helvetica;
}
    </style>
    <script>
        
        sessionStorage.removeItem("_x_currentTab");
    </script>
</head>
<body style="background-color: #1D1F39;">
    <% if(locals.msg){ %>
        <% if(msg==1){ %> 
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            Successfully reviewed 
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <%}else if(msg==2){ %> 
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                You are not logged in 
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        <%}else if(msg==3){ %> 
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                Successfully edited review 
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        <%}%>
    <%}%> 
    
    <div class="other-section ">
        <div class="row">
            <div class="col-12">
                <ul class="nav nav-tabs py-3" style="background-color:#000;">
                    <li class="nav-item me-auto">
                        <a class="ms-5" href="/home"><img
                            src="/pictures/Capture.PNG"
                            class="logo"
                            width="340px"
                            height="100em"
                          /></a>
                    </li>
                    <%if(username){%>
                        <li class="nav-item dropdown me-5">
                            <a style="color: #FFF89C" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false"><%=username%></a>
                            <ul class="dropdown-menu">
                              <li><a class="dropdown-item" href="/dashboard">Dashboard</a></li>
                              <%if(locals.admin){%>
                                <li><a class="dropdown-item" href="/admindashboard">Admin Dashboard</a></li>
                                <li><a class="dropdown-item" href="/adminuserreport">User report</a></li>
                                <li><a class="dropdown-item" href="/admincontentreport">Content report</a></li>
                              <%}%>
                              <li><a class="dropdown-item" href="/unanimous/profile">My profile</a></li>
                              <li><a class="dropdown-item" href="/catalogue">Catalogue</a></li>
                              <li><a class="dropdown-item" href="/profile/followlist">My follow list</a></li>
                              <li><a class="dropdown-item" href="/nkash">My nkash</a></li>
                              <li><a class="dropdown-item" href="/subscription">Buy subscription</a></li>
                              <li><a class="dropdown-item" href="/submission">Submissions</a></li>
                              <li><a class="dropdown-item" href="/post">Forum</a></li>
                              <li><a class="dropdown-item" href="/searchby">SearchByCategory</a></li>
                              <li><hr class="dropdown-divider"></li>
                              <li><a class="dropdown-item" href="/home/logout">Logout</a></li>
                            </ul>
                        </li>
                    <%}else{%>
                        <li class="nav-item">
                            <a class="nav-link  my-link-style2 text-uppercase" href="/users/logPage">Login</a>
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link  my-link-style2 text-uppercase" href="/users/register">Register</a>
                        </li>
                    <%}%>
                </ul>
            </div>
        </div>  
    </div> 
    <div class="container box">
        <div class="row">
            <!-- <div class="col-2"></div> -->
            <div class="col-9 mx-auto my auto">
                <br><br><br>
                <p style="font-size:20px ;"><b>Reference: </b><a style="text-decoration: none; color:violet" href="/contents/<%=locals.id%>/<%=locals.type%>"><%=locals.contentname%></a></p>
                <div class="row">
                    <div class="col-6 mx-auto my-auto">
                        <img src="<%=locals.character[3]%>" class="img-eye img-thumbnail">
                    </div>
                    <div class="col-6 mx-auto my-auto">
                        <h4>Name: <%=locals.character[1]%></h4>
                        <h5>Type: <%=locals.character[2]%></h5>
                    </div>
                </div>
                <Big style="font: size 20px;"><b>Description:</b></Big><hr>
                <div class="card space">
                    <div class="card-body space">
                        <pre class="space"><%=locals.character[5]%></pre>
                    </div>
                </div>
            </div>
            
            <div class="col-3 mx-auto my-auto">
                <!-- Button trigger modal -->
            <div class="row my-auto mx-auto">
                <button type="button" class="btn btn-primary my-auto" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                    See reviews
                </button>
                
                <!-- Modal -->
                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">User reviews</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <%for(let i=0;i<locals.reviews.length;i++){%>
                                <div class="col-md-12"style="border:2px solid white;">
                                    <pre>User: #<%=locals.reviews[i][0]%></pre>
                                    <pre>Rating: <%=locals.reviews[i][1]%></pre>
                                    <pre>Review: <br></pre>
                                    <div class="card ">
                                        <div class="card-body" >
                                            <pre><%=locals.reviews[i][2]%></pre>
                                        </div>
                                    </div>
                                    <br><br>
                                </div>
                                <%}%>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary"data-bs-dismiss="modal">Ok</button>
                        </div>
                    </div>
                </div>
                </div>
            </div>
            <div class="row">
                <%if(locals.rate){%>
                    <a class="mb-3 d-block" href="#inforev" data-bs-toggle="collapse"aria-expanded="false" aria-controls="info">Edit review & rating</a>
                    <div id="inforev" class="collapse">
                        <form action="/character/review/update/<%=id%>/<%=type%>/<%=charId%>" method="post" onsubmit="return fetching(this)" name="revform">
                            <label class="label-primary">Edit review and edit rating</label><br>
                            <span id="1"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                            <span id="2"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                            <span id="3"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                            <span id="4"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                            <span id="5"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                            <div class="form-outline">
                                <textarea name="review" class="form-control" placeholder="Enter your review" rows="4" id="rev"></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary" >Submit</button>
                            <!-- <button type="submit"  class="btn btn-primary" id="nafsave" data-id="<%=id%>"data-type="<%=type%>">Submit</button> -->
                        </form>
                    </div>
                    <br><br><br>
                <%}else{%>
                    <form action="/character/review/<%=id%>/<%=type%>/<%=charId%>" method="post" onsubmit="return fetching(this)" name="revform">
                        <label class="label-primary">Write a review and give rating</label><br>
                        <span name="one" id="1"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                        <span id="2"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                        <span id="3"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                        <span id="4"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                        <span id="5"  style="font-size:40px;cursor:pointer;" class="fa fa-star rank"></span>
                        <div class="form-outline">
                            <textarea name="review" class="form-control" placeholder="Enter your review" rows="4" id="rev"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" >Submit</button>
                        <!-- <button type="submit"  class="btn btn-primary" id="nafsave" data-id="<%=id%>"data-type="<%=type%>">Submit</button> -->
                    </form>
                <%}%>
            </div>
                
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>var target = document.querySelectorAll(".fa");
        target.forEach(e=>{
          e.addEventListener("click",function(){
              starmark2(e);
          },false);
        });
        target.forEach(e=>{
          e.addEventListener("mouseover",function(){
              starmark(e);
          },false);
        });
        target.forEach(e=>{
          e.addEventListener("mouseout",function(){
              starmarkout(e);
          },false);
        });
        function fetching(id){
            //console.log(count);
            if(count==0){
                swal({
                title: "Error!",
                text: "Give both review and rating",
                icon: "warning",
                button: "Ok",
                });
                return false;
            }
            const form = document.forms['revform'];
            if(form['review'].value.length==0){
                swal({
                title: "Error!",
                text: "Give both review and rating",
                icon: "warning",
                button: "Ok",
                });
                return false;
            }
            fetch('/character/rating',{
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(
                    {
                        "rating":count
                    }
                )
            });
       
        }
        var count;
        var bool=true;
        function starmark(item)
        {
            if(bool){
                count=item.id;
                sessionStorage.starRating = count;
                for(var i=1;i<=5;i++){
                    if(i<=count){
                        document.getElementById(i).style.color="orange";
                    }
                    else{
                        document.getElementById(i).style.color="black";
                    }
                }
            }
        }
        function starmark2(item)
        {
            bool=false;
            count=item.id;
            sessionStorage.starRating = count;
            for(var i=1;i<=5;i++){
                if(i<=count){
                    document.getElementById(i).style.color="orange";
                }
                else{
                    document.getElementById(i).style.color="black";
                }
            }
        }
        function starmarkout(item)
        {
            if(bool){
                count=0;
                for(var i=1;i<=5;i++){
                    if(i<=count){
                        document.getElementById(i).style.color="orange";
                    }
                    else{
                        document.getElementById(i).style.color="black";
                    }
                }
            }
        }
        function rank(){
            return count;
        }
      </script> 
</body>
</html>